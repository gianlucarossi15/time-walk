#### Unifying Graph Traversals and Time Series Joins in Hybrid Graphs repository code
This repository contains code and resources for the research paper "Unifying Graph Traversals and Time Series Joins in Hybrid Graphs" 
by Gianluca Rossi (Lyon 1 University & CNRS Liris), Angela Bonifati (Lyon 1 University, CNRS Liris & IUF), Riccardo Tommasini (INSA Lyon University & CNRS Liris).

This work defines a declarative framework to express and evaluate queries that combine graph traversals and time series joins over hybrid graph data models.

The repository includes:
- Java code implementing the Time-Walk operator as a Java plugin, for enabling time series joins within graph traversals and for exmperimental evaluation.
- Python code for data preprocessing and plots.
- Ingestion scripts for loading hybrid graph data into a graph database.

### Data representation
The **HyGraph** data structure has been implemented in **Neo4j** for both the graph and time series components.  
Each time series is represented by two property lists, one for timestamps and one for values, attached to the corresponding node in the graph.


### Data generation
 - The **FinBench** datasets were obtained from the official repository:  
   [https://drive.google.com/drive/folders/1NIAo4KptskBytbXoOqmF3Sto4hTX3JIH](https://drive.google.com/drive/folders/1NIAo4KptskBytbXoOqmF3Sto4hTX3JIH) made available by LDBC council itself.
    Experiments were conducted using the following scaling factors: **0.01**, **0.1**, **0.3**, and **1.0**. Each dataset has been enriched with the balance time series for the Account node type, 2000, 4000, 6000, and 10000 time series respectively.
    Each dataset was further enriched with balance time series for the **Account** node type, containing 2k, 4k, 6k, and 10k time series, respectively.
 - The **Synthea** datasets were obtained from the official repository:  
   [https://github.com/synthetichealth/synthea](https://github.com/synthetichealth/synthea) by collecting generated data for 5k, 10k, 30k and 100k patients.
   For each patient we collected the heart rate, body weight, body height, respitoraty rate, BMI from the Observations.csv file, generated by the Synthea generator.
    We created the parental and friendship relationships among patients in order to create a connected graph structure by looking at age gap and city of residence, taken from the patients.csv file.
 - NYC dataset has been downloaded from the repository: [https://zenodo.org/records/13846868](https://zenodo.org/records/13846868).
   No further processing is needed for the NYC dataset, as the time series are already associated with the corresponding nodes in the graph.

### Ingestion
For the ingestion use the scripts in the `resources/scripts` folder and place them in the `import` folder of your Neo4j database installation.

### Execution
All experiments were conducted using Neo4j Enterprise 5.26.12 TimeWalk operator has developed a dedicated Java plugin that extends the Neo4j API. Experiments were executed using the parallel Cypher runtime, with Java 17 on an M1 Max processor (10 cores) and 64 GB of RAM.
You can use Neo4j Community Edition as well, but please note that the performance may vary due to the lack of certain optimizations available in the Enterprise Edition.
In order to run the experiments, please follow these steps:
1. Use the maven to build the Time-Walk plugin:
   ```bash
   mvn clean install
   ```
   ```bash
   mvn clean package
   ```

2. Move the produced `timeWalk-1.0-SNAPSHOT.jar` file from the `target` folder to the `plugins` folder of your Neo4j database installation and make sure to enable the `apoc` and `time-walk` procedures in the `neo4j.conf` file:
   ```
   dbms.security.procedures.unrestricted=apoc.*,timewalk.*
   ```
3.  Start your Neo4j database.